{"version":3,"file":"gltf-transform-util.umd.js","sources":["../src/container.ts","../src/logger.ts","../src/util.ts"],"sourcesContent":["interface IBufferMap { [s: string]: ArrayBuffer; }\n\n/**\n * Wrapper for a glTF asset.\n */\nclass GLTFContainer {\n  constructor(public json: GLTF.IGLTF, public resources: IBufferMap) {}\n\n  /**\n   * Resolves a resource URI.\n   * @param uri\n   */\n  resolveURI(uri: string): ArrayBuffer {\n    return this.resources[uri];\n  }\n\n  /**\n   * Adds a new image to the glTF container.\n   * @param container\n   * @param name\n   * @param file\n   * @param type\n   */\n  addImage(name: string, file: ArrayBuffer, type: string): GLTFContainer {\n    let uri, mimeType\n    switch (type) {\n      case 'image/jpeg':\n        uri = `${name}.jpg`;\n        mimeType = GLTF.ImageMimeType.JPEG;\n        break;\n      case 'image/png':\n        uri = `${name}.png`;\n        mimeType = GLTF.ImageMimeType.PNG;\n        break;\n      default:\n        throw new Error(`Unsupported image type, \"${type}\".`);\n    }\n    this.json.images.push({ name, mimeType, uri });\n    this.resources[uri] = file;\n    return this;\n  }\n\n  /**\n   * Removes an image from the glTF container. Fails if image is still in use.\n   * @param container\n   * @param index\n   */\n  removeImage(index: number): GLTFContainer {\n    const textures = this.json.textures.filter((texture) => texture.source === index);\n    if (textures.length) {\n      throw new Error(`Image is in use by ${textures.length} textures and cannot be removed.`);\n    }\n    const image = this.json.images[index];\n    const imageBuffer = this.resolveURI(image.uri);\n    if (!imageBuffer) {\n      throw new Error('No such image, or image is embedded.');\n    }\n    this.json.images.splice(index, 1);\n    this.json.textures.forEach((texture) => {\n      if (texture.source > index) texture.source--;\n    });\n    return this;\n  }\n\n  /**\n   * Adds a new buffer to the glTF container.\n   * @param container\n   * @param name\n   * @param buffer\n   */\n  addBuffer(name: string, buffer: ArrayBuffer): GLTFContainer {\n    const uri = `${name}.bin`;\n    this.json.buffers.push({ name, uri, byteLength: buffer.byteLength });\n    this.resources[uri] = buffer;\n    return this;\n  }\n\n  /**\n   * Removes a buffer from the glTF container. Fails if buffer is still in use.\n   * @param container\n   * @param index\n   */\n  removeBuffer(index: number): GLTFContainer {\n    const bufferViews = this.json.bufferViews.filter((view) => view.buffer === index);\n    if (bufferViews.length) {\n      throw new Error(`Buffer is in use by ${bufferViews.length} bufferViews and cannot be removed.`);\n    }\n    const buffer = this.json.buffers[index];\n    this.json.buffers.splice(index, 1);\n    delete this.resources[buffer.uri];\n    return this;\n  }\n\n  addAccessor(array: Float32Array | Uint32Array | Uint16Array, type: GLTF.AccessorType, target: number): GLTFContainer {\n    throw new Error('Not implemented.');\n  }\n\n  /**\n   * Returns the accessor for the given index, as a typed array.\n   * @param index\n   */\n  getAccessorArray(index: number): Float32Array | Uint32Array | Uint16Array {\n    const accessor = this.json.accessors[index];\n    const type = accessor.type;\n    const bufferView = this.json.bufferViews[accessor.bufferView];\n    const buffer = this.json.buffers[bufferView.buffer];\n    const resource = this.resources[buffer.uri];\n\n    let valueSize;\n    switch (accessor.type) {\n      case GLTF.AccessorType.VEC4:\n        valueSize = 4;\n        break;\n      case GLTF.AccessorType.VEC3:\n        valueSize = 3;\n        break;\n      case GLTF.AccessorType.VEC2:\n        valueSize = 2;\n        break;\n      default:\n        throw new Error(`Accessor type ${accessor.type} not implemented.`);\n    }\n\n    let elementSize;\n    let data;\n    switch (accessor.componentType) {\n      case GLTF.AccessorComponentType.FLOAT:\n        elementSize = Float32Array.BYTES_PER_ELEMENT;\n        data = resource.slice(bufferView.byteOffset + accessor.byteOffset, accessor.count * valueSize * elementSize);\n        return new Float32Array(data);\n      case GLTF.AccessorComponentType.UNSIGNED_INT:\n        elementSize = Uint32Array.BYTES_PER_ELEMENT;\n        data = resource.slice(bufferView.byteOffset + accessor.byteOffset, accessor.count * valueSize * elementSize);\n        return new Uint32Array(data);\n      case GLTF.AccessorComponentType.UNSIGNED_SHORT:\n        elementSize = Uint16Array.BYTES_PER_ELEMENT;\n        data = resource.slice(bufferView.byteOffset + accessor.byteOffset, accessor.count * valueSize * elementSize);\n        return new Uint16Array(data);\n      default:\n        throw new Error(`Accessor componentType ${accessor.componentType} not implemented.`);\n    }\n  }\n}\n\nexport { GLTFContainer, IBufferMap };\n","enum LoggerVerbosity {\n  NONE = 3,\n  ERROR = 2,\n  WARNING = 1,\n  INFO = 0,\n}\n\n/**\n * Logger utility class.\n */\nclass Logger {\n  constructor (private name: string, private verbosity: LoggerVerbosity) {}\n\n  /**\n   * Logs at level INFO.\n   * @param text\n   */\n  info (text: string) {\n    if (this.verbosity >= LoggerVerbosity.INFO) {\n      console.log(`${this.name}: ${text}`);\n    }\n  }\n\n  /**\n   * Logs at level WARNING.\n   * @param text\n   */\n  warn (text: string) {\n    if (this.verbosity >= LoggerVerbosity.WARNING) {\n      console.warn(`${this.name}: ${text}`);\n    }\n  }\n\n  /**\n   * Logs at level ERROR.\n   * @param text\n   */\n  error (text: string) {\n    if (this.verbosity >= LoggerVerbosity.ERROR) {\n      console.error(`${this.name}: ${text}`);\n    }\n  }\n\n}\n\nexport { Logger, LoggerVerbosity };\n","import { GLTFContainer, IBufferMap } from './container';\nimport { Logger, LoggerVerbosity } from './logger';\n\ninterface IGLTFAnalysis {\n  meshes: number,\n  textures: number,\n  materials: number,\n  animations: number,\n  primitives: number,\n  dataUsage: {\n    geometry: number,\n    targets: number,\n    animation: number,\n    textures: number,\n    json: number\n  }\n};\n\n/**\n * Utility class for glTF transforms.\n */\nclass GLTFUtil {\n  /**\n   * Creates a GLTFContainer from the given JSON and files.\n   * @param json\n   * @param files\n   */\n  static wrapGLTF(json: GLTF.IGLTF, resources: IBufferMap) {\n    return new GLTFContainer(json, resources);\n  }\n\n  /**\n   * Creates a GLTFContainer from the given GLB binary.\n   * @param glb\n   */\n  static wrapGLB(glb: ArrayBuffer): GLTFContainer {\n    // Decode and verify GLB header.\n    const header = new Uint32Array(glb, 0, 3);\n    if (header[0] !== 0x46546C67) {\n      throw new Error('Invalid glTF asset.');\n    } else if (header[1] !== 2) {\n      throw new Error(`Unsupported glTF binary version, \"${header[1]}\".`);\n    }\n\n    // Decode and verify chunk headers.\n    const jsonChunkHeader = new Uint32Array(glb, 12, 2);\n    const jsonByteOffset = 20;\n    const jsonByteLength = jsonChunkHeader[0];\n    const binaryChunkHeader = new Uint32Array(glb, jsonByteOffset + jsonByteLength, 2);\n    if (jsonChunkHeader[1] !== 0x4E4F534A || binaryChunkHeader[1] !== 0x004E4942) {\n      throw new Error('Unexpected GLB layout.');\n    }\n\n    // Decode content.    \n    const jsonText = this.decodeText(glb.slice(jsonByteOffset, jsonByteOffset + jsonByteLength));\n    const json = JSON.parse(jsonText) as GLTF.IGLTF;\n    const binaryByteOffset = jsonByteOffset + jsonByteLength + 8;\n    const binaryByteLength = binaryChunkHeader[0];\n    const binary = glb.slice(binaryByteOffset, binaryByteOffset + binaryByteLength);\n    const buffer = json.buffers.filter((b) => !b.uri).pop();\n    buffer.uri = 'resources.bin';\n\n    // TODO(donmccurdy): Unpack embedded textures.\n    // TODO(donmccurdy): Decode Draco content.\n\n    return new GLTFContainer(json, {'resources.bin': binary});\n  }\n\n  /**\n   * Serializes a GLTFContainer to GLTF JSON and external files.\n   * @param container\n   */\n  static bundleGLTF(container: GLTFContainer): {json: Object, resources: IBufferMap} {\n    const {json, resources} = container;\n    return {json, resources};\n  }\n\n  /**\n   * Serializes a GLTFContainer to a GLB binary.\n   * @param container\n   */\n  static bundleGLB(container: GLTFContainer): ArrayBuffer {\n    throw new Error('Not implemented.');\n  }\n\n  /**\n   * Creates an empty buffer.\n   */\n  static createBuffer(): ArrayBuffer {\n    if (typeof Buffer === 'undefined') {\n      // Browser.\n      return new ArrayBuffer(0);\n    } else {\n      // Node.js.\n      return new Buffer([]);\n    }\n  }\n\n  /**\n   * Creates a buffer from a Data URI.\n   * @param dataURI\n   */\n  static createBufferFromDataURI(dataURI: string): ArrayBuffer {\n    if (typeof Buffer === 'undefined') {\n      // Browser.\n      const byteString = atob(dataURI.split(',')[1]);\n      const ia = new Uint8Array(byteString.length);\n      for (let i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i);\n      }\n      return ia.buffer;\n    } else {\n      // Node.js.\n      return new Buffer(dataURI.split(',')[1], 'base64');\n    }\n  }\n\n  static createLogger(name: string, verbosity: LoggerVerbosity): Logger {\n    return new Logger(name, verbosity);\n  }\n\n  static encodeText(text: string): ArrayBuffer {\n    if (typeof TextEncoder !== 'undefined') {\n      return new TextEncoder().encode(text);\n    }\n    return Buffer.from(text).buffer;\n  }\n\n  static decodeText(buffer: ArrayBuffer): string {\n    if (typeof TextDecoder !== 'undefined') {\n      return new TextDecoder().decode(buffer);\n    }\n    const a = Buffer.from(buffer) as any; \n    return a.toString('utf8');\n  }\n\n  static analyze(container: GLTFContainer): IGLTFAnalysis {\n    const report = {\n      meshes: (container.json.meshes||[]).length,\n      textures: (container.json.textures||[]).length,\n      materials: (container.json.materials||[]).length,\n      animations: (container.json.animations||[]).length,\n      primitives: 0,\n      dataUsage: {\n        geometry: 0,\n        targets: 0,\n        animation: 0,\n        textures: 0,\n        json: 0\n      }\n    };\n\n    // Primitives and targets.\n    (container.json.meshes||[]).forEach((mesh) => {\n      report.primitives += mesh.primitives.length;\n      mesh.primitives.forEach((primitive) => {\n        if (primitive.indices !== undefined) {\n          report.dataUsage.geometry += this.getAccessorByteLength(container.json.accessors[primitive.indices]);\n        }\n        Object.keys(primitive.attributes).forEach((attr) => {\n          const accessor = container.json.accessors[primitive.attributes[attr]];\n          report.dataUsage.geometry += this.getAccessorByteLength(accessor);\n        });\n\n        (primitive.targets||[]).forEach((target) => {\n          Object.keys(target).forEach((attr) => {\n            const accessor = container.json.accessors[target[attr]];\n            report.dataUsage.targets += this.getAccessorByteLength(accessor);\n          });\n        });\n      });\n    });\n\n    // Animation\n    (container.json.animations||[]).forEach((animation) => {\n      animation.samplers.forEach((sampler) => {\n        const input = container.json.accessors[sampler.input];\n        const output = container.json.accessors[sampler.output];\n        report.dataUsage.animation += this.getAccessorByteLength(input);\n        report.dataUsage.animation += this.getAccessorByteLength(output);\n      });\n    });\n\n    // Textures\n    (container.json.images||[]).forEach((image) => {\n      if (image.uri !== undefined) {\n        report.dataUsage.textures += container.resolveURI(image.uri).byteLength;\n      } else {\n        report.dataUsage.textures += container.json.bufferViews[image.bufferView].byteLength;\n      }\n    });\n\n    // JSON\n    report.dataUsage.json += JSON.stringify(container.json).length;\n\n    return report;\n  }\n\n  static getAccessorByteLength(accessor: GLTF.IAccessor): number {\n    const itemSize = AccessorType[accessor.type].size;\n    const valueSize = AccessorComponentType[accessor.componentType].size;\n    return itemSize * valueSize * accessor.count;\n  }\n}\n\nconst AccessorType = {\n  SCALAR: {value: 'SCALAR', size: 1},\n  VEC2: {value: 'VEC2', size: 2},\n  VEC3: {value: 'VEC3', size: 3},\n  VEC4: {value: 'VEC4', size: 4},\n  MAT2: {value: 'MAT2', size: 4},\n  MAT3: {value: 'MAT3', size: 9},\n  MAT4: {value: 'MAT4', size: 16},\n}\n\nconst AccessorComponentType = {\n  '5120': {value: 'BYTE', size: 1 },\n  '5121': {value: 'UNSIGNED_BYTE', size: 1 },\n  '5122': {value: 'SHORT', size: 2 },\n  '5123': {value: 'UNSIGNED_SHORT', size: 2 },\n  '5125': {value: 'UNSIGNED_INT', size: 4 },\n  '5126': {value: 'FLOAT', size: 4 },\n};\n\nexport { GLTFUtil };\n"],"names":["LoggerVerbosity"],"mappings":"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"}