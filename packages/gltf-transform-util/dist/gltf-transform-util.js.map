{"version":3,"file":"gltf-transform-util.js","sources":["../src/container.ts","../src/logger.ts","../src/util.ts"],"sourcesContent":["interface IBufferMap { [s: string]: ArrayBuffer; }\n\n/**\n * Wrapper for a glTF asset.\n */\nclass GLTFContainer {\n  constructor(public json: GLTF.IGLTF, public resources: IBufferMap) {}\n\n  /**\n   * Resolves a resource URI.\n   * @param uri\n   */\n  resolveURI(uri: string): ArrayBuffer {\n    return this.resources[uri];\n  }\n\n  /**\n   * Adds a new image to the glTF container.\n   * @param container\n   * @param name\n   * @param file\n   * @param type\n   */\n  addImage(name: string, file: ArrayBuffer, type: string): GLTFContainer {\n    let uri, mimeType\n    switch (type) {\n      case 'image/jpeg':\n        uri = `${name}.jpg`;\n        mimeType = GLTF.ImageMimeType.JPEG;\n        break;\n      case 'image/png':\n        uri = `${name}.png`;\n        mimeType = GLTF.ImageMimeType.PNG;\n        break;\n      default:\n        throw new Error(`Unsupported image type, \"${type}\".`);\n    }\n    this.json.images.push({ name, mimeType, uri });\n    this.resources[uri] = file;\n    return this;\n  }\n\n  /**\n   * Removes an image from the glTF container. Fails if image is still in use.\n   * @param container\n   * @param index\n   */\n  removeImage(index: number): GLTFContainer {\n    const textures = this.json.textures.filter((texture) => texture.source === index);\n    if (textures.length) {\n      throw new Error(`Image is in use by ${textures.length} textures and cannot be removed.`);\n    }\n    const image = this.json.images[index];\n    const imageBuffer = this.resolveURI(image.uri);\n    if (!imageBuffer) {\n      throw new Error('No such image, or image is embedded.');\n    }\n    this.json.images.splice(index, 1);\n    this.json.textures.forEach((texture) => {\n      if (texture.source > index) texture.source--;\n    });\n    return this;\n  }\n\n  /**\n   * Adds a new buffer to the glTF container.\n   * @param container\n   * @param name\n   * @param buffer\n   */\n  addBuffer(name: string, buffer: ArrayBuffer): GLTFContainer {\n    const uri = `${name}.bin`;\n    this.json.buffers.push({ name, uri, byteLength: buffer.byteLength });\n    this.resources[uri] = buffer;\n    return this;\n  }\n\n  /**\n   * Removes a buffer from the glTF container. Fails if buffer is still in use.\n   * @param container\n   * @param index\n   */\n  removeBuffer(index: number): GLTFContainer {\n    const bufferViews = this.json.bufferViews.filter((view) => view.buffer === index);\n    if (bufferViews.length) {\n      throw new Error(`Buffer is in use by ${bufferViews.length} bufferViews and cannot be removed.`);\n    }\n    const buffer = this.json.buffers[index];\n    this.json.buffers.splice(index, 1);\n    delete this.resources[buffer.uri];\n    return this;\n  }\n\n  addAccessor(array: Float32Array | Uint32Array | Uint16Array, type: GLTF.AccessorType, target: number): GLTFContainer {\n    throw new Error('Not implemented.');\n  }\n\n  /**\n   * Returns the accessor for the given index, as a typed array.\n   * @param index\n   */\n  getAccessorArray(index: number): Float32Array | Uint32Array | Uint16Array {\n    const accessor = this.json.accessors[index];\n    const type = accessor.type;\n    const bufferView = this.json.bufferViews[accessor.bufferView];\n    const buffer = this.json.buffers[bufferView.buffer];\n    const resource = this.resources[buffer.uri];\n\n    let valueSize;\n    switch (accessor.type) {\n      case GLTF.AccessorType.VEC4:\n        valueSize = 4;\n        break;\n      case GLTF.AccessorType.VEC3:\n        valueSize = 3;\n        break;\n      case GLTF.AccessorType.VEC2:\n        valueSize = 2;\n        break;\n      default:\n        throw new Error(`Accessor type ${accessor.type} not implemented.`);\n    }\n\n    let elementSize;\n    let data;\n    switch (accessor.componentType) {\n      case GLTF.AccessorComponentType.FLOAT:\n        elementSize = Float32Array.BYTES_PER_ELEMENT;\n        data = resource.slice(bufferView.byteOffset + accessor.byteOffset, accessor.count * valueSize * elementSize);\n        return new Float32Array(data);\n      case GLTF.AccessorComponentType.UNSIGNED_INT:\n        elementSize = Uint32Array.BYTES_PER_ELEMENT;\n        data = resource.slice(bufferView.byteOffset + accessor.byteOffset, accessor.count * valueSize * elementSize);\n        return new Uint32Array(data);\n      case GLTF.AccessorComponentType.UNSIGNED_SHORT:\n        elementSize = Uint16Array.BYTES_PER_ELEMENT;\n        data = resource.slice(bufferView.byteOffset + accessor.byteOffset, accessor.count * valueSize * elementSize);\n        return new Uint16Array(data);\n      default:\n        throw new Error(`Accessor componentType ${accessor.componentType} not implemented.`);\n    }\n  }\n}\n\nexport { GLTFContainer, IBufferMap };\n","enum LoggerVerbosity {\n  NONE = 3,\n  ERROR = 2,\n  WARNING = 1,\n  INFO = 0,\n}\n\n/**\n * Logger utility class.\n */\nclass Logger {\n  constructor (private name: string, private verbosity: LoggerVerbosity) {}\n\n  /**\n   * Logs at level INFO.\n   * @param text\n   */\n  info (text: string) {\n    if (this.verbosity >= LoggerVerbosity.INFO) {\n      console.log(`${this.name}: ${text}`);\n    }\n  }\n\n  /**\n   * Logs at level WARNING.\n   * @param text\n   */\n  warn (text: string) {\n    if (this.verbosity >= LoggerVerbosity.WARNING) {\n      console.warn(`${this.name}: ${text}`);\n    }\n  }\n\n  /**\n   * Logs at level ERROR.\n   * @param text\n   */\n  error (text: string) {\n    if (this.verbosity >= LoggerVerbosity.ERROR) {\n      console.error(`${this.name}: ${text}`);\n    }\n  }\n\n}\n\nexport { Logger, LoggerVerbosity };\n","import { GLTFContainer, IBufferMap } from './container';\nimport { Logger, LoggerVerbosity } from './logger';\n\ninterface IGLTFAnalysis {\n  meshes: number,\n  textures: number,\n  materials: number,\n  animations: number,\n  primitives: number,\n  dataUsage: {\n    geometry: number,\n    targets: number,\n    animation: number,\n    textures: number,\n    json: number\n  }\n};\n\n/**\n * Utility class for glTF transforms.\n */\nclass GLTFUtil {\n  /**\n   * Creates a GLTFContainer from the given JSON and files.\n   * @param json\n   * @param files\n   */\n  static wrapGLTF(json: GLTF.IGLTF, resources: IBufferMap) {\n    return new GLTFContainer(json, resources);\n  }\n\n  /**\n   * Creates a GLTFContainer from the given GLB binary.\n   * @param glb\n   */\n  static wrapGLB(glb: ArrayBuffer): GLTFContainer {\n    // Decode and verify GLB header.\n    const header = new Uint32Array(glb, 0, 3);\n    if (header[0] !== 0x46546C67) {\n      throw new Error('Invalid glTF asset.');\n    } else if (header[1] !== 2) {\n      throw new Error(`Unsupported glTF binary version, \"${header[1]}\".`);\n    }\n\n    // Decode and verify chunk headers.\n    const jsonChunkHeader = new Uint32Array(glb, 12, 2);\n    const jsonByteOffset = 20;\n    const jsonByteLength = jsonChunkHeader[0];\n    const binaryChunkHeader = new Uint32Array(glb, jsonByteOffset + jsonByteLength, 2);\n    if (jsonChunkHeader[1] !== 0x4E4F534A || binaryChunkHeader[1] !== 0x004E4942) {\n      throw new Error('Unexpected GLB layout.');\n    }\n\n    // Decode content.    \n    const jsonText = this.decodeText(glb.slice(jsonByteOffset, jsonByteOffset + jsonByteLength));\n    const json = JSON.parse(jsonText) as GLTF.IGLTF;\n    const binaryByteOffset = jsonByteOffset + jsonByteLength + 8;\n    const binaryByteLength = binaryChunkHeader[0];\n    const binary = glb.slice(binaryByteOffset, binaryByteOffset + binaryByteLength);\n    const buffer = json.buffers.filter((b) => !b.uri).pop();\n    buffer.uri = 'resources.bin';\n\n    // TODO(donmccurdy): Unpack embedded textures.\n    // TODO(donmccurdy): Decode Draco content.\n\n    return new GLTFContainer(json, {'resources.bin': binary});\n  }\n\n  /**\n   * Serializes a GLTFContainer to GLTF JSON and external files.\n   * @param container\n   */\n  static bundleGLTF(container: GLTFContainer): {json: Object, resources: IBufferMap} {\n    const {json, resources} = container;\n    return {json, resources};\n  }\n\n  /**\n   * Serializes a GLTFContainer to a GLB binary.\n   * @param container\n   */\n  static bundleGLB(container: GLTFContainer): ArrayBuffer {\n    throw new Error('Not implemented.');\n  }\n\n  /**\n   * Creates an empty buffer.\n   */\n  static createBuffer(): ArrayBuffer {\n    if (typeof Buffer === 'undefined') {\n      // Browser.\n      return new ArrayBuffer(0);\n    } else {\n      // Node.js.\n      return new Buffer([]);\n    }\n  }\n\n  /**\n   * Creates a buffer from a Data URI.\n   * @param dataURI\n   */\n  static createBufferFromDataURI(dataURI: string): ArrayBuffer {\n    if (typeof Buffer === 'undefined') {\n      // Browser.\n      const byteString = atob(dataURI.split(',')[1]);\n      const ia = new Uint8Array(byteString.length);\n      for (let i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i);\n      }\n      return ia.buffer;\n    } else {\n      // Node.js.\n      return new Buffer(dataURI.split(',')[1], 'base64');\n    }\n  }\n\n  static createLogger(name: string, verbosity: LoggerVerbosity): Logger {\n    return new Logger(name, verbosity);\n  }\n\n  static encodeText(text: string): ArrayBuffer {\n    if (typeof TextEncoder !== 'undefined') {\n      return new TextEncoder().encode(text);\n    }\n    return Buffer.from(text).buffer;\n  }\n\n  static decodeText(buffer: ArrayBuffer): string {\n    if (typeof TextDecoder !== 'undefined') {\n      return new TextDecoder().decode(buffer);\n    }\n    const a = Buffer.from(buffer) as any; \n    return a.toString('utf8');\n  }\n\n  static analyze(container: GLTFContainer): IGLTFAnalysis {\n    const report = {\n      meshes: (container.json.meshes||[]).length,\n      textures: (container.json.textures||[]).length,\n      materials: (container.json.materials||[]).length,\n      animations: (container.json.animations||[]).length,\n      primitives: 0,\n      dataUsage: {\n        geometry: 0,\n        targets: 0,\n        animation: 0,\n        textures: 0,\n        json: 0\n      }\n    };\n\n    // Primitives and targets.\n    (container.json.meshes||[]).forEach((mesh) => {\n      report.primitives += mesh.primitives.length;\n      mesh.primitives.forEach((primitive) => {\n        if (primitive.indices !== undefined) {\n          report.dataUsage.geometry += this.getAccessorByteLength(container.json.accessors[primitive.indices]);\n        }\n        Object.keys(primitive.attributes).forEach((attr) => {\n          const accessor = container.json.accessors[primitive.attributes[attr]];\n          report.dataUsage.geometry += this.getAccessorByteLength(accessor);\n        });\n\n        (primitive.targets||[]).forEach((target) => {\n          Object.keys(target).forEach((attr) => {\n            const accessor = container.json.accessors[target[attr]];\n            report.dataUsage.targets += this.getAccessorByteLength(accessor);\n          });\n        });\n      });\n    });\n\n    // Animation\n    (container.json.animations||[]).forEach((animation) => {\n      animation.samplers.forEach((sampler) => {\n        const input = container.json.accessors[sampler.input];\n        const output = container.json.accessors[sampler.output];\n        report.dataUsage.animation += this.getAccessorByteLength(input);\n        report.dataUsage.animation += this.getAccessorByteLength(output);\n      });\n    });\n\n    // Textures\n    (container.json.images||[]).forEach((image) => {\n      if (image.uri !== undefined) {\n        report.dataUsage.textures += container.resolveURI(image.uri).byteLength;\n      } else {\n        report.dataUsage.textures += container.json.bufferViews[image.bufferView].byteLength;\n      }\n    });\n\n    // JSON\n    report.dataUsage.json += JSON.stringify(container.json).length;\n\n    return report;\n  }\n\n  static getAccessorByteLength(accessor: GLTF.IAccessor): number {\n    const itemSize = AccessorType[accessor.type].size;\n    const valueSize = AccessorComponentType[accessor.componentType].size;\n    return itemSize * valueSize * accessor.count;\n  }\n}\n\nconst AccessorType = {\n  SCALAR: {value: 'SCALAR', size: 1},\n  VEC2: {value: 'VEC2', size: 2},\n  VEC3: {value: 'VEC3', size: 3},\n  VEC4: {value: 'VEC4', size: 4},\n  MAT2: {value: 'MAT2', size: 4},\n  MAT3: {value: 'MAT3', size: 9},\n  MAT4: {value: 'MAT4', size: 16},\n}\n\nconst AccessorComponentType = {\n  '5120': {value: 'BYTE', size: 1 },\n  '5121': {value: 'UNSIGNED_BYTE', size: 1 },\n  '5122': {value: 'SHORT', size: 2 },\n  '5123': {value: 'UNSIGNED_SHORT', size: 2 },\n  '5125': {value: 'UNSIGNED_INT', size: 4 },\n  '5126': {value: 'FLOAT', size: 4 },\n};\n\nexport { GLTFUtil };\n"],"names":["LoggerVerbosity"],"mappings":";;;;AAEA;;;AAGA;IACE,uBAAmB,IAAgB,EAAS,SAAqB;QAA9C,SAAI,GAAJ,IAAI,CAAY;QAAS,cAAS,GAAT,SAAS,CAAY;KAAI;;;;;IAMrE,kCAAU,GAAV,UAAW,GAAW;QACpB,OAAO,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;KAC5B;;;;;;;;IASD,gCAAQ,GAAR,UAAS,IAAY,EAAE,IAAiB,EAAE,IAAY;QACpD,IAAI,GAAG,EAAE,QAAQ,CAAA;QACjB,QAAQ,IAAI;YACV,KAAK,YAAY;gBACf,GAAG,GAAM,IAAI,SAAM,CAAC;gBACpB,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;gBACnC,MAAM;YACR,KAAK,WAAW;gBACd,GAAG,GAAM,IAAI,SAAM,CAAC;gBACpB,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC;gBAClC,MAAM;YACR;gBACE,MAAM,IAAI,KAAK,CAAC,+BAA4B,IAAI,QAAI,CAAC,CAAC;SACzD;QACD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,IAAI,MAAA,EAAE,QAAQ,UAAA,EAAE,GAAG,KAAA,EAAE,CAAC,CAAC;QAC/C,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;QAC3B,OAAO,IAAI,CAAC;KACb;;;;;;IAOD,mCAAW,GAAX,UAAY,KAAa;QACvB,IAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,UAAC,OAAO,IAAK,OAAA,OAAO,CAAC,MAAM,KAAK,KAAK,GAAA,CAAC,CAAC;QAClF,IAAI,QAAQ,CAAC,MAAM,EAAE;YACnB,MAAM,IAAI,KAAK,CAAC,wBAAsB,QAAQ,CAAC,MAAM,qCAAkC,CAAC,CAAC;SAC1F;QACD,IAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACtC,IAAM,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC/C,IAAI,CAAC,WAAW,EAAE;YAChB,MAAM,IAAI,KAAK,CAAC,sCAAsC,CAAC,CAAC;SACzD;QACD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,OAAO;YACjC,IAAI,OAAO,CAAC,MAAM,GAAG,KAAK;gBAAE,OAAO,CAAC,MAAM,EAAE,CAAC;SAC9C,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACb;;;;;;;IAQD,iCAAS,GAAT,UAAU,IAAY,EAAE,MAAmB;QACzC,IAAM,GAAG,GAAM,IAAI,SAAM,CAAC;QAC1B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,MAAA,EAAE,GAAG,KAAA,EAAE,UAAU,EAAE,MAAM,CAAC,UAAU,EAAE,CAAC,CAAC;QACrE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC;QAC7B,OAAO,IAAI,CAAC;KACb;;;;;;IAOD,oCAAY,GAAZ,UAAa,KAAa;QACxB,IAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,UAAC,IAAI,IAAK,OAAA,IAAI,CAAC,MAAM,KAAK,KAAK,GAAA,CAAC,CAAC;QAClF,IAAI,WAAW,CAAC,MAAM,EAAE;YACtB,MAAM,IAAI,KAAK,CAAC,yBAAuB,WAAW,CAAC,MAAM,wCAAqC,CAAC,CAAC;SACjG;QACD,IAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACxC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QACnC,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAClC,OAAO,IAAI,CAAC;KACb;IAED,mCAAW,GAAX,UAAY,KAA+C,EAAE,IAAuB,EAAE,MAAc;QAClG,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;KACrC;;;;;IAMD,wCAAgB,GAAhB,UAAiB,KAAa;QAC5B,IAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAC5C,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;QAC3B,IAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAC9D,IAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACpD,IAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAE5C,IAAI,SAAS,CAAC;QACd,QAAQ,QAAQ,CAAC,IAAI;YACnB,KAAK,IAAI,CAAC,YAAY,CAAC,IAAI;gBACzB,SAAS,GAAG,CAAC,CAAC;gBACd,MAAM;YACR,KAAK,IAAI,CAAC,YAAY,CAAC,IAAI;gBACzB,SAAS,GAAG,CAAC,CAAC;gBACd,MAAM;YACR,KAAK,IAAI,CAAC,YAAY,CAAC,IAAI;gBACzB,SAAS,GAAG,CAAC,CAAC;gBACd,MAAM;YACR;gBACE,MAAM,IAAI,KAAK,CAAC,mBAAiB,QAAQ,CAAC,IAAI,sBAAmB,CAAC,CAAC;SACtE;QAED,IAAI,WAAW,CAAC;QAChB,IAAI,IAAI,CAAC;QACT,QAAQ,QAAQ,CAAC,aAAa;YAC5B,KAAK,IAAI,CAAC,qBAAqB,CAAC,KAAK;gBACnC,WAAW,GAAG,YAAY,CAAC,iBAAiB,CAAC;gBAC7C,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,KAAK,GAAG,SAAS,GAAG,WAAW,CAAC,CAAC;gBAC7G,OAAO,IAAI,YAAY,CAAC,IAAI,CAAC,CAAC;YAChC,KAAK,IAAI,CAAC,qBAAqB,CAAC,YAAY;gBAC1C,WAAW,GAAG,WAAW,CAAC,iBAAiB,CAAC;gBAC5C,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,KAAK,GAAG,SAAS,GAAG,WAAW,CAAC,CAAC;gBAC7G,OAAO,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC;YAC/B,KAAK,IAAI,CAAC,qBAAqB,CAAC,cAAc;gBAC5C,WAAW,GAAG,WAAW,CAAC,iBAAiB,CAAC;gBAC5C,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,KAAK,GAAG,SAAS,GAAG,WAAW,CAAC,CAAC;gBAC7G,OAAO,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC;YAC/B;gBACE,MAAM,IAAI,KAAK,CAAC,4BAA0B,QAAQ,CAAC,aAAa,sBAAmB,CAAC,CAAC;SACxF;KACF;IACH,oBAAC;CAAA;;AC9ID,WAAK,eAAe;IAClB,qDAAQ,CAAA;IACR,uDAAS,CAAA;IACT,2DAAW,CAAA;IACX,qDAAQ,CAAA;CACT,EALIA,uBAAe,KAAfA,uBAAe,QAKnB;;;;AAKD;IACE,gBAAqB,IAAY,EAAU,SAA0B;QAAhD,SAAI,GAAJ,IAAI,CAAQ;QAAU,cAAS,GAAT,SAAS,CAAiB;KAAI;;;;;IAMzE,qBAAI,GAAJ,UAAM,IAAY;QAChB,IAAI,IAAI,CAAC,SAAS,IAAIA,uBAAe,CAAC,IAAI,EAAE;YAC1C,OAAO,CAAC,GAAG,CAAI,IAAI,CAAC,IAAI,UAAK,IAAM,CAAC,CAAC;SACtC;KACF;;;;;IAMD,qBAAI,GAAJ,UAAM,IAAY;QAChB,IAAI,IAAI,CAAC,SAAS,IAAIA,uBAAe,CAAC,OAAO,EAAE;YAC7C,OAAO,CAAC,IAAI,CAAI,IAAI,CAAC,IAAI,UAAK,IAAM,CAAC,CAAC;SACvC;KACF;;;;;IAMD,sBAAK,GAAL,UAAO,IAAY;QACjB,IAAI,IAAI,CAAC,SAAS,IAAIA,uBAAe,CAAC,KAAK,EAAE;YAC3C,OAAO,CAAC,KAAK,CAAI,IAAI,CAAC,IAAI,UAAK,IAAM,CAAC,CAAC;SACxC;KACF;IAEH,aAAC;CAAA;;ACzBD;;;AAGA;IAAA;KAsLC;;;;;;IAhLQ,iBAAQ,GAAf,UAAgB,IAAgB,EAAE,SAAqB;QACrD,OAAO,IAAI,aAAa,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;KAC3C;;;;;IAMM,gBAAO,GAAd,UAAe,GAAgB;;QAE7B,IAAM,MAAM,GAAG,IAAI,WAAW,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC1C,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,UAAU,EAAE;YAC5B,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;SACxC;aAAM,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE;YAC1B,MAAM,IAAI,KAAK,CAAC,wCAAqC,MAAM,CAAC,CAAC,CAAC,QAAI,CAAC,CAAC;SACrE;;QAGD,IAAM,eAAe,GAAG,IAAI,WAAW,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACpD,IAAM,cAAc,GAAG,EAAE,CAAC;QAC1B,IAAM,cAAc,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC;QAC1C,IAAM,iBAAiB,GAAG,IAAI,WAAW,CAAC,GAAG,EAAE,cAAc,GAAG,cAAc,EAAE,CAAC,CAAC,CAAC;QACnF,IAAI,eAAe,CAAC,CAAC,CAAC,KAAK,UAAU,IAAI,iBAAiB,CAAC,CAAC,CAAC,KAAK,UAAU,EAAE;YAC5E,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;SAC3C;;QAGD,IAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,cAAc,EAAE,cAAc,GAAG,cAAc,CAAC,CAAC,CAAC;QAC7F,IAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAe,CAAC;QAChD,IAAM,gBAAgB,GAAG,cAAc,GAAG,cAAc,GAAG,CAAC,CAAC;QAC7D,IAAM,gBAAgB,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC;QAC9C,IAAM,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,gBAAgB,EAAE,gBAAgB,GAAG,gBAAgB,CAAC,CAAC;QAChF,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,CAAC,GAAG,GAAA,CAAC,CAAC,GAAG,EAAE,CAAC;QACxD,MAAM,CAAC,GAAG,GAAG,eAAe,CAAC;;;QAK7B,OAAO,IAAI,aAAa,CAAC,IAAI,EAAE,EAAC,eAAe,EAAE,MAAM,EAAC,CAAC,CAAC;KAC3D;;;;;IAMM,mBAAU,GAAjB,UAAkB,SAAwB;QACjC,IAAA,qBAAI,EAAE,+BAAS,CAAc;QACpC,OAAO,EAAC,IAAI,MAAA,EAAE,SAAS,WAAA,EAAC,CAAC;KAC1B;;;;;IAMM,kBAAS,GAAhB,UAAiB,SAAwB;QACvC,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;KACrC;;;;IAKM,qBAAY,GAAnB;QACE,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;;YAEjC,OAAO,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC;SAC3B;aAAM;;YAEL,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC;SACvB;KACF;;;;;IAMM,gCAAuB,GAA9B,UAA+B,OAAe;QAC5C,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;;YAEjC,IAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/C,IAAM,EAAE,GAAG,IAAI,UAAU,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YAC7C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC1C,EAAE,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;aAClC;YACD,OAAO,EAAE,CAAC,MAAM,CAAC;SAClB;aAAM;;YAEL,OAAO,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;SACpD;KACF;IAEM,qBAAY,GAAnB,UAAoB,IAAY,EAAE,SAA0B;QAC1D,OAAO,IAAI,MAAM,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;KACpC;IAEM,mBAAU,GAAjB,UAAkB,IAAY;QAC5B,IAAI,OAAO,WAAW,KAAK,WAAW,EAAE;YACtC,OAAO,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SACvC;QACD,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC;KACjC;IAEM,mBAAU,GAAjB,UAAkB,MAAmB;QACnC,IAAI,OAAO,WAAW,KAAK,WAAW,EAAE;YACtC,OAAO,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;SACzC;QACD,IAAM,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAQ,CAAC;QACrC,OAAO,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;KAC3B;IAEM,gBAAO,GAAd,UAAe,SAAwB;QAAvC,iBA4DC;QA3DC,IAAM,MAAM,GAAG;YACb,MAAM,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,IAAE,EAAE,EAAE,MAAM;YAC1C,QAAQ,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,IAAE,EAAE,EAAE,MAAM;YAC9C,SAAS,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,IAAE,EAAE,EAAE,MAAM;YAChD,UAAU,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,IAAE,EAAE,EAAE,MAAM;YAClD,UAAU,EAAE,CAAC;YACb,SAAS,EAAE;gBACT,QAAQ,EAAE,CAAC;gBACX,OAAO,EAAE,CAAC;gBACV,SAAS,EAAE,CAAC;gBACZ,QAAQ,EAAE,CAAC;gBACX,IAAI,EAAE,CAAC;aACR;SACF,CAAC;;QAGF,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,IAAE,EAAE,EAAE,OAAO,CAAC,UAAC,IAAI;YACvC,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC;YAC5C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,SAAS;gBAChC,IAAI,SAAS,CAAC,OAAO,KAAK,SAAS,EAAE;oBACnC,MAAM,CAAC,SAAS,CAAC,QAAQ,IAAI,KAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;iBACtG;gBACD,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI;oBAC7C,IAAM,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;oBACtE,MAAM,CAAC,SAAS,CAAC,QAAQ,IAAI,KAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;iBACnE,CAAC,CAAC;gBAEH,CAAC,SAAS,CAAC,OAAO,IAAE,EAAE,EAAE,OAAO,CAAC,UAAC,MAAM;oBACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI;wBAC/B,IAAM,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;wBACxD,MAAM,CAAC,SAAS,CAAC,OAAO,IAAI,KAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;qBAClE,CAAC,CAAC;iBACJ,CAAC,CAAC;aACJ,CAAC,CAAC;SACJ,CAAC,CAAC;;QAGH,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,IAAE,EAAE,EAAE,OAAO,CAAC,UAAC,SAAS;YAChD,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,OAAO;gBACjC,IAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBACtD,IAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBACxD,MAAM,CAAC,SAAS,CAAC,SAAS,IAAI,KAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;gBAChE,MAAM,CAAC,SAAS,CAAC,SAAS,IAAI,KAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;aAClE,CAAC,CAAC;SACJ,CAAC,CAAC;;QAGH,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,IAAE,EAAE,EAAE,OAAO,CAAC,UAAC,KAAK;YACxC,IAAI,KAAK,CAAC,GAAG,KAAK,SAAS,EAAE;gBAC3B,MAAM,CAAC,SAAS,CAAC,QAAQ,IAAI,SAAS,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC;aACzE;iBAAM;gBACL,MAAM,CAAC,SAAS,CAAC,QAAQ,IAAI,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,UAAU,CAAC;aACtF;SACF,CAAC,CAAC;;QAGH,MAAM,CAAC,SAAS,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC;QAE/D,OAAO,MAAM,CAAC;KACf;IAEM,8BAAqB,GAA5B,UAA6B,QAAwB;QACnD,IAAM,QAAQ,GAAG,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;QAClD,IAAM,SAAS,GAAG,qBAAqB,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC;QACrE,OAAO,QAAQ,GAAG,SAAS,GAAG,QAAQ,CAAC,KAAK,CAAC;KAC9C;IACH,eAAC;CAAA,IAAA;AAED,IAAM,YAAY,GAAG;IACnB,MAAM,EAAE,EAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,EAAC;IAClC,IAAI,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAC;IAC9B,IAAI,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAC;IAC9B,IAAI,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAC;IAC9B,IAAI,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAC;IAC9B,IAAI,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAC;IAC9B,IAAI,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAC;CAChC,CAAA;AAED,IAAM,qBAAqB,GAAG;IAC5B,MAAM,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAE;IACjC,MAAM,EAAE,EAAC,KAAK,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,EAAE;IAC1C,MAAM,EAAE,EAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE;IAClC,MAAM,EAAE,EAAC,KAAK,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC,EAAE;IAC3C,MAAM,EAAE,EAAC,KAAK,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC,EAAE;IACzC,MAAM,EAAE,EAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE;CACnC,CAAC;;;;;;"}