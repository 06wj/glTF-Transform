var e,r=function(){function e(e,r){this.json=e,this.resources=r}return e.prototype.resolveURI=function(e){return this.resources[e]},e.prototype.addImage=function(e,r,t){var n,s;switch(t){case"image/jpeg":n=e+".jpg",s="image/jpeg";break;case"image/png":n=e+".png",s="image/png";break;default:throw new Error('Unsupported image type, "'+t+'".')}return this.json.images.push({name:e,mimeType:s,uri:n}),this.resources[n]=r,this},e.prototype.removeImage=function(e){var r=this.json.textures.filter(function(r){return r.source===e});if(r.length)throw new Error("Image is in use by "+r.length+" textures and cannot be removed.");if(!this.resolveURI(this.json.images[e].uri))throw new Error("No such image, or image is embedded.");return this.json.images.splice(e,1),this.json.textures.forEach(function(r){r.source>e&&r.source--}),this},e.prototype.addBuffer=function(e,r){var t=e+".bin";return this.json.buffers.push({name:e,uri:t,byteLength:r.byteLength}),this.resources[t]=r,this},e.prototype.removeBuffer=function(e){var r=this.json.bufferViews.filter(function(r){return r.buffer===e});if(r.length)throw new Error("Buffer is in use by "+r.length+" bufferViews and cannot be removed.");var t=this.json.buffers[e];return this.json.buffers.splice(e,1),delete this.resources[t.uri],this},e.prototype.addAccessor=function(e,r,t){throw new Error("Not implemented.")},e.prototype.getAccessorArray=function(e){var r,t,n,s=this.json.accessors[e],o=this.json.bufferViews[s.bufferView],i=this.resources[this.json.buffers[o.buffer].uri];switch(s.type){case"VEC4":r=4;break;case"VEC3":r=3;break;case"VEC2":r=2;break;default:throw new Error("Accessor type "+s.type+" not implemented.")}switch(s.componentType){case 5126:return t=Float32Array.BYTES_PER_ELEMENT,n=i.slice(o.byteOffset+s.byteOffset,s.count*r*t),new Float32Array(n);case 5125:return t=Uint32Array.BYTES_PER_ELEMENT,n=i.slice(o.byteOffset+s.byteOffset,s.count*r*t),new Uint32Array(n);case 5123:return t=Uint16Array.BYTES_PER_ELEMENT,n=i.slice(o.byteOffset+s.byteOffset,s.count*r*t),new Uint16Array(n);default:throw new Error("Accessor componentType "+s.componentType+" not implemented.")}},e}();(e=exports.LoggerVerbosity||(exports.LoggerVerbosity={}))[e.NONE=3]="NONE",e[e.ERROR=2]="ERROR",e[e.WARNING=1]="WARNING",e[e.INFO=0]="INFO";var t=function(){function e(e,r){this.name=e,this.verbosity=r}return e.prototype.info=function(e){this.verbosity>=exports.LoggerVerbosity.INFO&&console.log(this.name+": "+e)},e.prototype.warn=function(e){this.verbosity>=exports.LoggerVerbosity.WARNING&&console.warn(this.name+": "+e)},e.prototype.error=function(e){this.verbosity>=exports.LoggerVerbosity.ERROR&&console.error(this.name+": "+e)},e}(),n=function(){function e(){}return e.wrapGLTF=function(e,t){return new r(e,t)},e.wrapGLB=function(e){var t=new Uint32Array(e,0,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error('Unsupported glTF binary version, "'+t[1]+'".');var n=new Uint32Array(e,12,2),s=new Uint32Array(e,20+n[0],2);if(1313821514!==n[1]||5130562!==s[1])throw new Error("Unexpected GLB layout.");var o=n[0],i=JSON.parse(this.decodeText(e.slice(20,20+o))),a=20+o,c=e.slice(a,a+s[0]);return i.buffers.find(function(e){return!e.uri}).uri="resources.bin",new r(i,{"resources.bin":c})},e.bundleGLTF=function(e){return{json:e.json,resources:e.resources}},e.bundleGLB=function(e){throw new Error("Not implemented.")},e.createBuffer=function(){return"undefined"==typeof Buffer?new ArrayBuffer(0):new Buffer([])},e.createBufferFromDataURI=function(e){if("undefined"==typeof Buffer){for(var r=atob(e.split(",")[1]),t=new Uint8Array(r.length),n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t.buffer}return new Buffer(e.split(",")[1],"base64")},e.createLogger=function(e,r){return new t(e,r)},e.encodeText=function(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e).buffer},e.decodeText=function(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")},e.analyze=function(e){var r=this,t={meshes:(e.json.meshes||[]).length,textures:(e.json.textures||[]).length,materials:(e.json.materials||[]).length,animations:(e.json.animations||[]).length,primitives:0,dataUsage:{geometry:0,targets:0,animation:0,textures:0,json:0}};return(e.json.meshes||[]).forEach(function(n){t.primitives+=n.primitives.length,n.primitives.forEach(function(n){void 0!==n.indices&&(t.dataUsage.geometry+=r.getAccessorByteLength(e.json.accessors[n.indices])),Object.keys(n.attributes).forEach(function(s){t.dataUsage.geometry+=r.getAccessorByteLength(e.json.accessors[n.attributes[s]])}),(n.targets||[]).forEach(function(n){Object.keys(n).forEach(function(s){t.dataUsage.targets+=r.getAccessorByteLength(e.json.accessors[n[s]])})})})}),(e.json.animations||[]).forEach(function(n){n.samplers.forEach(function(n){var s=e.json.accessors[n.output];t.dataUsage.animation+=r.getAccessorByteLength(e.json.accessors[n.input]),t.dataUsage.animation+=r.getAccessorByteLength(s)})}),(e.json.images||[]).forEach(function(r){t.dataUsage.textures+=void 0!==r.uri?e.resolveURI(r.uri).byteLength:e.json.bufferViews[r.bufferView].byteLength}),t.dataUsage.json+=JSON.stringify(e.json).length,t},e.getAccessorByteLength=function(e){var r,t;switch(e.type){case"VEC4":r=4;break;case"VEC3":r=3;break;case"VEC2":r=2;break;case"MAT4":r=16;break;case"MAT3":r=9;break;case"MAT2":r=4;break;case"SCALAR":r=1;break;default:throw new Error("Unexpected accessor type, "+e.type+".")}switch(e.componentType){case 5125:case 5126:t=4;break;case 5123:case 5122:t=2;break;case 5121:case 5120:t=1}return r*t*e.count},e}();exports.GLTFUtil=n,exports.GLTFContainer=r,exports.Logger=t;
//# sourceMappingURL=gltf-transform-util.js.map
